---
author: Kate Lopresti <kate.lopresti@puppet.com\>
---

# How manifest blocks are applied

When you run a plan that contains a manifest block, the `apply_prep` function installs the packages necessary to run the Bolt `apply` command.

The `apply_prep` function identifies the nodes that do not have Puppet agents and runs the `puppet_agent::install` task \(from the [puppet\_agent module](https://github.com/puppetlabs/puppetlabs-puppet_agent)\). It also copies over custom facts from Bolt's modulepath and runs `facter` on the target nodes.

Behind the scenes, Bolt compiles the code in your manifest block \(the code wrapped in curly braces that follows the `apply` function\) into a catalog. Code is compiled in descending order of precedence:

-    `Facts` gathered from the targets or set in your inventory
-   Local variables in the plan, such as `$site_content` 
-    `Vars` set in your inventory

Like the code compiled with the `puppet apply` function, all the variables are generated. As a result, you can resuse code between Bolt and Puppet. It then copies custom module content from the Bolt modulepath to the target nodes and applies the catalog using Puppet.

After the catalog compiles and is executed successfully on all targets, `apply` returns the reports generated by applying the catalog on each node.

## Options

The `apply` action supports common metaparameters available to other Bolt functions.

```
apply(Boltlib::TargetSpec $targets, Optional[Hash[String[1], Any]] $options)
```

Returns: `ResultSet` containing ApplyResult.

-   `_catch_errors => true` returns a `ResultSet` including failed results, rather than failing the plan.

-   `_noop => true` applies the manifest block in Puppet no-operation mode, returning a report of the changes it would make, but takes no action.

-   `_run_as => <user>`applies the manifest block as the specified user \(on transports that support it\).


## Return Value of Apply Action

The apply action returns a `ResultSet` with an `ApplyResult` object for each target.

**Related information**  


[Handling plan function results](writing_plans.md#)

## Configuring Concurrency

Each target requires a separate catalog be compiled with its unique facts and vars.

The apply action compiles and applies catalogs in parallel on the Bolt host. Concurrency of catalog compilation is controlled by a `compile-concurrency` config option. This option is limited to twice the number of threads your CPU can run concurrently, while catalog application uses the Bolt default thread pool controlled by the `concurrency` option.

